@using DataLayer.Notificacao
@using DataLayer.Utilizador
@using DataLayer.Leilao
@inject Microsoft.AspNetCore.Components.NavigationManager NavigationManager
@inject NavigationManager Navigation
@inject INotificacaoRepository NotificacaoRepo
@inject IUtilizadorRepository UtilizadorRepo
@inject ILeilaoRepository LeilaoRepo

<div class="notification-box">
    <div class="comp">
        @if (notificacao != null)
        {
            <span>
                @switch (notificacao.Tipo)
                {
                    case "Ganhou":
                        <div class="container">
                            <div class="noti-msg" @onclick="NavigateToPage">
                                <span>Ganhou o leilão! Contacte o dono do relógio: @userInfo?.email</span>
                            </div>
                            <div class="noti-button">
                                <button class="bi bi-trash3-fill-not" aria-hidden="true" @onclick="RemoveNotification"></button>
                            </div>
                        </div>
                        break;
                    case "LeilaoFavoritoTerminou":
                        <div class="container">
                            <div class="noti-msg" @onclick="NavigateToPage">
                                <span>O leilão favorito terminou!</span>
                            </div>
                            <div class="noti-button">
                                <button class="bi bi-trash3-fill-not" aria-hidden="true" @onclick="RemoveNotification"></button>
                            </div>
                        </div>
                        break;
                    case "LeilaoFavoritoComecou":
                        <div class="container">
                            <div class="noti-msg" @onclick="NavigateToPage">
                                <span>O leilão favorito começou!</span>
                            </div>
                            <div class="noti-button">
                                <button class="bi bi-trash3-fill-not" aria-hidden="true" @onclick="RemoveNotification"></button>
                            </div>
                        </div>
                        break;
                    case "LicitacaoNoFavorito":
                        <div class="container">
                            <div class="noti-msg" @onclick="NavigateToPage">
                                <span>Fizeram uma licitação no seu leilão favorito!</span>
                            </div>
                            <div class="noti-button">
                                <button class="bi bi-trash3-fill-not" aria-hidden="true" @onclick="RemoveNotification"></button>
                            </div>
                        </div>
                        break;
                    default:
                        <span>Mensagem de notificação padrão</span>
                        break;
                }
            </span>
        }
    </div>
</div>

@code {
    [Parameter, EditorRequired]
    public NotificacaoModel notificacao { get; set; } = default!;
    private UtilizadorModel userInfo;
    private UtilizadorModel leilaoInfo;

    private void RemoveNotification()
    {
        NotificacaoRepo.Remove(notificacao.Id);

        NavigationManager.NavigateTo("/notificacoes", forceLoad: true);
    }

    private void NavigateToPage()
    {
        // Adicione o redirecionamento para a página desejada
        Navigation.NavigateTo($"/leilao/{notificacao.Leilao_idLeilao}");
    }

    protected override async Task OnInitializedAsync()
    {
        try
        {
            userInfo = await LeilaoRepo.FindUser(notificacao.Leilao_idLeilao);
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Erro ao recuperar informações do utilizador: {ex.Message}");
        }
    }
}
